events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    server {
        listen 8080;
        server_name _;

        # Serve main landing page
        location = / {
            root /usr/share/nginx/html;
            try_files /index.html =404;
        }

        # Proxy to testone (App Engine)
        location /testone/ {
            rewrite ^/testone/(.*) /$1 break;
            proxy_pass https://ai-club-dot-circle4life-dev.uc.r.appspot.com;
            proxy_set_header Host ai-club-dot-circle4life-dev.uc.r.appspot.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_server_name on;
            proxy_ssl_verify off;
            proxy_redirect off;
            
            # Important for assets
            proxy_set_header Accept-Encoding "";
            sub_filter_once off;
            sub_filter_types *;
        }

        # Proxy to testtwo (App Engine)
        location /testtwo/ {
            rewrite ^/testtwo/(.*) /$1 break;
            proxy_pass https://aiclub-dot-circle4life-dev.uc.r.appspot.com;
            proxy_set_header Host aiclub-dot-circle4life-dev.uc.r.appspot.com;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_ssl_server_name on;
            proxy_ssl_verify off;
            proxy_redirect off;
            
            # Important for assets
            proxy_set_header Accept-Encoding "";
            sub_filter_once off;
            sub_filter_types *;
        }
    }
}